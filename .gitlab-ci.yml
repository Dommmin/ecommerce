stages:
  - build
  - test

variables:
  # Define environment variables such as database configurations
  DB_CONNECTION: mysql
  DB_HOST: mysql
  DB_DATABASE: test_database
  DB_USERNAME: root
  DB_PASSWORD: secret

services:
  - mysql:latest

before_script:
  - apt-get update -qy
  - apt-get install -y unzip
  - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
  - cp .env.example .env
  - composer install --no-ansi --no-interaction --no-progress --no-scripts --no-suggest --optimize-autoloader

cache:
  paths:
    - vendor/

build:
  script:
    - php artisan key:generate
    - php artisan config:clear
    - php artisan config:cache
    - php artisan migrate --env=testing
    - php artisan db:seed --env=testing

test:
  script:
    - vendor/bin/phpunit